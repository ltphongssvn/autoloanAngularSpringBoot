# .pre-commit-config.yaml
# Pre-commit hooks for autoloanAngularSpringBoot (Angular + Spring Boot)
repos:
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.5.0
    hooks:
      - id: detect-secrets
        args: ['--baseline', '.secrets.baseline']

  - repo: local
    hooks:
      - id: block-large-binaries
        name: Block Large Binary Files
        entry: bash -c 'for f in "$@"; do case "$f" in *.h5|*.pkl|*.pth|*.onnx|*.parquet|*.sqlite3|*.jar|*.war) echo "Blocked binary $f"; exit 1;; esac; done' --
        language: system
        types: [file]

      - id: block-env-files
        name: Block .env Files (allow .env.example)
        entry: bash -c 'for f in "$@"; do base=$(basename "$f"); if echo "$base" | grep -qE "^\.env($|\.)"; then if [ "$base" != ".env.example" ]; then echo "Blocked env file $f"; exit 1; fi; fi; done' --
        language: system
        types: [file]

      - id: fix-line-endings
        name: Fix Line Endings to LF
        entry: bash -c 'for f in "$@"; do if file "$f" | grep -q text; then sed -i "s/\r$//" "$f"; fi; done; exit 0' --
        language: system
        types: [file]

      - id: fix-eof
        name: Fix End of Files
        entry: bash -c 'exit 0' --
        language: system
        types: [file]

      - id: trailing-whitespace
        name: Trim Trailing Whitespace
        entry: bash -c 'for f in "$@"; do if file "$f" | grep -q text; then sed -i "s/[[:space:]]*$//" "$f"; fi; done; exit 0' --
        language: system
        types: [file]

      - id: validate-json
        exclude: (node_modules/|.vscode/|tsconfig.*.json)
        name: Validate JSON Files
        entry: bash -c 'for f in "$@"; do python3 -c "import json,sys; json.load(open(sys.argv[1]))" "$f" || exit 1; done' --
        language: system
        types: [json]

      - id: validate-yaml
        name: Validate YAML Files
        entry: bash -c 'for f in "$@"; do python3 -c "import yaml,sys; yaml.safe_load(open(sys.argv[1]))" "$f" || exit 1; done' --
        language: system
        types: [yaml]

      - id: check-large-files
        name: Check for Large Files
        entry: bash -c 'for f in "$@"; do base=$(basename "$f"); case "$base" in package-lock.json|pom.xml) continue;; esac; size=$(stat -c%s "$f" 2>/dev/null || stat -f%z "$f" 2>/dev/null); if [ "$size" -gt 512000 ]; then echo "File too large ${size}B $f"; exit 1; fi; done' --
        language: system
        types: [file]

      - id: lint-frontend
        name: Angular Lint (Frontend)
        entry: bash -c 'cd frontend && npx ng lint'
        language: system
        files: ^frontend/src/.*\.(ts|html)$
        pass_filenames: false

      - id: compile-backend
        name: Maven Compile (Backend)
        entry: bash -c 'cd backend && mvn compile -q'
        language: system
        files: ^backend/src/.*\.java$
        pass_filenames: false

      - id: test-backend
        name: Backend Unit Tests (Maven + JaCoCo)
        entry: bash -c 'cd backend && mvn test -q'
        language: system
        files: ^backend/src/.*\.java$
        pass_filenames: false

      - id: test-frontend
        name: Frontend Unit Tests (Vitest)
        entry: bash -c 'cd frontend && npx ng test --no-watch'
        language: system
        files: ^frontend/src/.*\.(ts|html)$
        pass_filenames: false

  - repo: local
    hooks:
      - id: coverage-backend
        name: Backend Coverage Check (pre-push)
        entry: bash -c 'cd backend && mvn verify -q'
        language: system
        stages: [pre-push]
        pass_filenames: false

      - id: coverage-frontend
        name: Frontend Coverage Check (pre-push)
        entry: bash -c 'cd frontend && npx ng test --no-watch --code-coverage'
        language: system
        stages: [pre-push]
        pass_filenames: false

      - id: build-backend
        name: Backend Build (pre-push)
        entry: bash -c 'cd backend && mvn package -q -DskipTests'
        language: system
        stages: [pre-push]
        pass_filenames: false

      - id: build-frontend
        name: Frontend Build (pre-push)
        entry: bash -c 'cd frontend && npx ng build'
        language: system
        stages: [pre-push]
        pass_filenames: false
